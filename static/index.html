<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Chatbot AI - Universal Tutor</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Gemini Dark Palette */
      --bg: #131314;
      --surface: #1E1F20;
      --surface-2: #2D2E30; /* Input fields, User bubbles */
      --line: #444746;
      
      --text-main: #E3E3E3;
      --text-sub: #C4C7C5;
      --text-muted: #8E918F;

      --accent-gradient: linear-gradient(135deg, #4b90ff, #ff5546); /* Gemini Sparkle Vibe */
      --accent-blue: #A8C7FA;
      --accent-blue-dim: rgba(168, 199, 250, 0.1);
      
      --success: #6DD58C;
      --error: #F2B8B5; /* Soft Red */
      
      --radius-l: 24px;
      --radius-m: 16px;
      --radius-s: 8px;

      --shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
      
      --font-body: 'Roboto', -apple-system, sans-serif;
      --font-head: 'Google Sans', 'Roboto', sans-serif;
      --mono: 'Menlo', 'Consolas', monospace;
    }

    * { box-sizing: border-box; }
    
    body {
      margin: 0;
      background-color: var(--bg);
      color: var(--text-main);
      font-family: var(--font-body);
      /* Subtle ambient glow */
      background-image: 
        radial-gradient(circle at 10% 10%, rgba(76, 141, 246, 0.05), transparent 40%),
        radial-gradient(circle at 90% 80%, rgba(217, 101, 112, 0.05), transparent 40%);
      min-height: 100vh;
    }

    /* --- Layout --- */
    .app-layout {
      max-width: 1600px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 20px;
      padding: 20px;
      height: 100vh;
    }
    
    @media (max-width: 1000px) {
      .app-layout { grid-template-columns: 1fr; height: auto; }
      .chat-panel { height: 80vh; }
    }

    /* --- Typography --- */
    h1, h2, h3, .title { font-family: var(--font-head); }
    
    /* --- Header --- */
    header {
      grid-column: 1 / -1;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 5px;
      border-bottom: 1px solid transparent;
    }
    .brand {
      font-size: 20px;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--text-main);
    }
    .brand-icon {
      background: var(--accent-gradient);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      font-weight: 700;
      font-size: 22px; 
      margin-right: 4px;
    }
    .pill-badge {
      font-size: 11px;
      background: var(--surface-2);
      color: var(--text-sub);
      padding: 4px 10px;
      border-radius: 99px;
      font-family: var(--mono);
    }

    /* --- Cards --- */
    .card {
      background: var(--surface);
      border-radius: var(--radius-l);
      display: flex;
      flex-direction: column;
      overflow: hidden;
      box-shadow: var(--shadow);
      border: 1px solid rgba(255,255,255,0.05);
    }

    .card-hd {
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }
    .card-title {
      font-size: 16px;
      font-weight: 500;
      color: var(--text-main);
    }

    /* --- Chat Area --- */
    .chat-panel {
      position: relative;
    }
    .msgs {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 24px;
      scroll-behavior: smooth;
    }
    
    .msg {
      max-width: 85%;
      line-height: 1.6;
      font-size: 15px;
      position: relative;
      word-break: break-word;
    }

    /* User Bubble */
    .msg.user {
      align-self: flex-end;
      background-color: var(--surface-2);
      color: var(--text-main);
      padding: 12px 18px;
      border-radius: 18px 18px 4px 18px;
    }

    /* Bot Bubble */
    .msg.bot {
      align-self: flex-start;
      padding: 0 10px 0 34px; /* Space for icon */
      color: var(--text-main);
    }
    .msg.bot::before {
      content: '‚ú®'; /* Gemini Sparkle */
      position: absolute;
      left: 0;
      top: 0;
      font-size: 18px;
    }

    /* Typing Indicator (Thinking Animation) */
    .typing-indicator {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 0;
    }
    .typing-dot {
      width: 6px;
      height: 6px;
      background-color: var(--text-sub);
      border-radius: 50%;
      animation: typing 1.4s infinite ease-in-out both;
    }
    .typing-dot:nth-child(1) { animation-delay: -0.32s; }
    .typing-dot:nth-child(2) { animation-delay: -0.16s; }
    
    @keyframes typing {
      0%, 80%, 100% { transform: scale(0); opacity: 0.5; }
      40% { transform: scale(1); opacity: 1; }
    }

    .meta-info {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 6px;
      font-family: var(--mono);
      opacity: 0.7;
    }

    .msg a {
      color: var(--accent-blue);
      text-decoration: none;
      border-bottom: 1px solid transparent;
      transition: .2s;
    }
    .msg a:hover {
      border-bottom-color: var(--accent-blue);
    }

    /* --- Composer (Input Area) --- */
    .composer {
      background: var(--surface);
      padding: 20px;
      border-top: 1px solid rgba(255,255,255,0.05);
    }
    .input-wrapper {
      background: var(--surface-2);
      border-radius: 28px;
      padding: 8px 8px 8px 20px;
      display: flex;
      align-items: flex-end;
      border: 1px solid transparent;
      transition: .2s;
    }
    .input-wrapper:focus-within {
      background: #252628;
      border-color: #555;
    }
    
    textarea {
      flex: 1;
      background: transparent;
      border: none;
      color: var(--text-main);
      font-size: 15px;
      font-family: var(--font-body);
      resize: none;
      outline: none;
      min-height: 24px;
      max-height: 120px;
      padding: 12px 0;
      line-height: 1.5;
    }
    textarea::placeholder { color: var(--text-muted); }

    /* --- Buttons --- */
    button {
      border: none;
      cursor: pointer;
      font-family: var(--font-head);
      font-size: 13px;
      font-weight: 500;
      padding: 8px 16px;
      border-radius: 20px;
      transition: .2s;
    }
    .btn-send {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--text-main);
      color: var(--bg);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: 10px;
      padding: 0;
    }
    .btn-send:hover { opacity: 0.9; transform: scale(1.05); }
    .btn-send svg { width: 20px; height: 20px; fill: currentColor; }

    .btn-text {
      background: transparent;
      color: var(--text-sub);
      border: 1px solid var(--line);
    }
    .btn-text:hover {
      background: var(--surface-2);
      color: var(--text-main);
    }
    
    .btn-chip {
      background: rgba(168, 199, 250, 0.08);
      color: var(--accent-blue);
    }
    .btn-chip:hover {
      background: rgba(168, 199, 250, 0.15);
    }

    .btn-reset {
      color: var(--error);
      background: rgba(242, 184, 181, 0.05);
    }
    .btn-reset:hover { background: rgba(242, 184, 181, 0.1); }

    /* --- Controls Panel (Compact Version) --- */
    .controls-panel {
      padding: 12px;
      overflow-y: auto;
      gap: 10px;
      display: flex;
      flex-direction: column;
    }
    
    .section-label {
      font-size: 11px;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 4px;
      margin-top: 8px;
    }
    
    input, select {
      width: 100%;
      background: var(--surface-2);
      border: 1px solid transparent;
      border-radius: 6px;
      padding: 6px 10px;
      color: var(--text-main);
      font-family: var(--font-body);
      font-size: 12px;
      height: 32px;
      outline: none;
      margin-bottom: 0;
    }
    input:focus, select:focus {
      border-color: var(--accent-blue);
      background: #252628;
    }

    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
    
    .code-block {
      background: #000;
      border-radius: 12px;
      padding: 12px;
      font-family: var(--mono);
      font-size: 11px;
      color: var(--text-sub);
      overflow-x: auto;
      border: 1px solid var(--line);
      max-height: 200px; 
      white-space: pre-wrap; 
    }

    .debug-header {
      font-size: 11px;
      font-weight: 700;
      margin-bottom: 6px;
      display: block;
    }

    /* Status Indicators */
    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 6px;
    }
    .status-dot.idle { background: var(--text-muted); }
    .status-dot.sending { background: var(--accent-blue); box-shadow: 0 0 8px var(--accent-blue); }
    .status-dot.error { background: var(--error); }

    /* PDF Drop Zone (Compact) */
    .drop-zone {
      border: 2px dashed var(--line);
      border-radius: var(--radius-m);
      padding: 12px;
      text-align: center;
      color: var(--text-sub);
      transition: .2s;
      background: rgba(255,255,255,0.02);
      margin-bottom: 4px;
      cursor: pointer;
    }
    .drop-zone.dragover {
      border-color: var(--accent-blue);
      background: rgba(168, 199, 250, 0.1);
      color: var(--accent-blue);
    }
    .drop-text { font-size: 12px; margin-top: 4px; }
    .drop-icon { font-size: 20px; }

    /* Scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #555; }
  </style>
</head>

<body>

<div class="app-layout">
  
  <header>
    <div class="brand">
      <span class="brand-icon">ü™ê</span>
      Universal Tutor Console
    </div>
    <div class="pill-badge" id="endpointChip">http://localhost:8000/api/chat</div>
  </header>

  <div class="card chat-panel">
    <div class="card-hd">
      <span class="card-title">Session</span>
      <div style="display:flex; gap:8px;">
        <button class="btn-text btn-reset" id="btnClear">Clear</button>
        <button class="btn-text btn-chip" id="btnExamples">Random Prompt</button>
      </div>
    </div>

    <div class="msgs" id="msgs">
      <div class="msg bot" style="opacity:0.6;">
        ÏïàÎÖïÌïòÏÑ∏Ïöî! Ï†ÄÎäî ÎßåÎä• Í≥ºÏô∏ ÏÑ†ÏÉùÎãòÏûÖÎãàÎã§. Î¨¥ÏóáÏù¥Îì† Î¨ºÏñ¥Î≥¥ÏÑ∏Ïöî!<br>
        <span class="meta-info">System Init</span>
      </div>
    </div>

    <div class="composer">
      <div class="input-wrapper">
        <textarea id="userMessage" rows="1" placeholder="ÏßàÎ¨∏ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî... (Enter to send)"></textarea>
        <button id="btnSend" class="btn-send">
          <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        </button>
      </div>
      <div style="display:flex; justify-content:space-between; align-items:center; margin-top:8px; padding:0 4px;">
        <div style="font-size:12px; color:var(--text-muted); display:flex; align-items:center;">
          <span id="statusDot" class="status-dot idle"></span>
          <span id="statusText">Ready</span>
        </div>
        <div style="font-size:11px; color:var(--text-muted); font-family:var(--mono);">
          Trace: <span id="traceId">-</span>
        </div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-hd">
      <span class="card-title">Configuration</span>
      <div style="display:flex; gap:6px;">
        <button class="btn-text" id="btnPresetEdu" style="font-size:11px;">Reset Settings</button>
      </div>
    </div>

    <div class="controls-panel">
      
      <div id="pdfDropZone" class="drop-zone">
        <div style="display:flex; align-items:center; justify-content:center; gap:8px;">
          <div class="drop-icon">üìÑ</div>
          <div class="drop-text" id="dropText">Drag PDF here for RAG</div>
        </div>
        <input type="file" id="pdfInput" accept=".pdf" style="display:none" />
      </div>

      <div>
        <div class="section-label">Connection</div>
        <input id="endpoint" value="http://localhost:8000/api/chat" placeholder="Endpoint URL" style="margin-bottom:6px;" />
        
        <div class="grid-3">
          <input id="clientSessionId" value="sess_web_1" placeholder="Session ID" />
          <select id="mode">
            <option value="edu" selected>Edu</option>
          </select>
          <input id="domain" value="education" placeholder="Domain" />
        </div>
      </div>

      <div>
        <div class="section-label">Settings</div>
        <div style="display:grid; grid-template-columns: 2fr 1fr 1fr; gap:8px;">
          <select id="userLevel">
              <option value="beginner">Beginner (Ï¥àÍ∏â)</option>
              <option value="intermediate">Intermediate (Ï§ëÍ∏â)</option>
              <option value="advanced" selected>Advanced (Ïã¨Ìôî)</option>
          </select>
          <select id="deviceType">
            <option value="web">Web</option>
            <option value="mobile">Mobile</option>
          </select>
          <select id="inputType">
            <option value="text">Text</option>
            <option value="voice">Voice</option>
          </select>
        </div>
      </div>

      <div style="flex:1; display:flex; flex-direction:column; min-height:0;">
        <div class="section-label">Debug Data</div>
        <div style="overflow-y:auto; display:flex; flex-direction:column; gap:8px; padding-right:4px;">
          
          <div>
            <span class="debug-header" style="color:var(--accent-blue);">üì§ Sent</span>
            <div class="code-block" id="reqJson" style="max-height:80px;">{}</div>
          </div>

          <div>
             <span class="debug-header" style="color:var(--success);">üì• Reply</span>
             <div class="code-block" id="replyJson" style="max-height:120px;">{}</div>
          </div>

          <div>
             <span class="debug-header" style="color:var(--text-sub);">üíæ State</span>
             <div class="code-block" id="stateJson" style="max-height:120px;">{}</div>
          </div>

        </div>
      </div>

      <input id="locale" type="hidden" value="ko-KR">
      <input id="timezone" type="hidden" value="Asia/Seoul">
      <input id="siteNavDbPath" type="hidden" value="data/site_nav.sqlite3">
      <textarea id="extraMeta" style="display:none;"></textarea>

    </div>
  </div>

</div>

<script>
  const $ = (id) => document.getElementById(id);
  const storeKey = "chatbot_tutor_config_v4"; // Config key updated

  function nowTime() {
    return new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
  }

  // URL Auto-Linker
  function linkify(text) {
    if (!text) return "";
    const urlPattern = /(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim;
    return text.replace(urlPattern, '<a href="$1" target="_blank">$1</a>');
  }

  function addMsg(role, text, metaLine) {
    const el = document.createElement("div");
    el.className = "msg " + (role === "user" ? "user" : "bot");
    
    el.innerHTML = linkify(text || "");

    if (metaLine) {
      const meta = document.createElement("div");
      meta.className = "meta-info";
      meta.innerHTML = metaLine; 
      el.appendChild(meta);
    }
    $("msgs").appendChild(el);
    setTimeout(() => {
      $("msgs").scrollTo({ top: $("msgs").scrollHeight, behavior: 'smooth' });
    }, 10);
  }

  // Show Thinking Animation
  function showThinking() {
    const el = document.createElement("div");
    el.className = "msg bot";
    el.id = "thinking-bubble";
    el.innerHTML = `
      <div class="typing-indicator">
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
      </div>
    `;
    $("msgs").appendChild(el);
    setTimeout(() => {
      $("msgs").scrollTo({ top: $("msgs").scrollHeight, behavior: 'smooth' });
    }, 10);
    return el;
  }

  function removeThinking() {
    const el = $("thinking-bubble");
    if (el) el.remove();
  }

  function setStatus(kind, text) {
    const dot = $("statusDot");
    const txt = $("statusText");
    
    dot.className = "status-dot " + (kind || "idle");
    txt.textContent = text;
  }

  function setJson(el, obj) {
    el.textContent = JSON.stringify(obj ?? {}, null, 2);
  }

  function buildMeta() {
    let extra = {};
    try {
      const raw = $("extraMeta").value.trim();
      if (raw) extra = JSON.parse(raw);
    } catch (e) {}

    const meta = {
      client_session_id: $("clientSessionId").value.trim(),
      mode: $("mode").value.trim(),
      domain: $("domain").value.trim(),
      locale: $("locale").value.trim(),
      timezone: $("timezone").value.trim(),
      device_type: $("deviceType").value.trim(),
      input_type: $("inputType").value.trim(),
      user_level: $("userLevel").value.trim(),
      ...extra,
    };
    
    meta.site_nav_db_path = $("siteNavDbPath").value.trim() || "data/site_nav.sqlite3";

    Object.keys(meta).forEach(k => {
      if (meta[k] === "" || meta[k] == null) delete meta[k];
    });
    return meta;
  }

  async function send() {
    const endpoint = $("endpoint").value.trim();
    $("endpointChip").textContent = endpoint;

    const inputEl = $("userMessage");
    const user_message = inputEl.value.trim();
    if (!user_message) return;

    inputEl.value = "";
    inputEl.style.height = 'auto'; 

    const meta = buildMeta();
    addMsg("user", user_message, `${nowTime()}`);
    setStatus("sending", "Thinking...");
    showThinking();

    const body = { user_message, meta };
    setJson($("reqJson"), body);
    saveState({ lastBody: body });

    try {
      const t0 = performance.now();
      const res = await fetch(endpoint, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body),
      });
      const dt = Math.round(performance.now() - t0);
      
      const json = await res.json().catch(() => ({}));
      const trace = json?.trace_id || json?.detail?.trace_id || "-";
      $("traceId").textContent = trace;

      removeThinking();

      if (!res.ok) {
        addMsg("bot", `Error ${res.status}: ` + (json.detail || "Unknown error"), `${dt}ms`);
        setStatus("error", "Error");
        setJson($("replyJson"), json);
        return;
      }

      const reply = json?.reply || {};
      const state = json?.state || {};
      const text = reply?.text ?? JSON.stringify(reply, null, 2);
      
      const intent = reply?.ui_hints?.intent || state?.active_intent || "-";
      
      let debugInfo = `${dt}ms ‚Ä¢ ${intent}`;
      if (meta.mode === 'edu' && meta.user_level) {
        debugInfo += ` ‚Ä¢ <span style='color:var(--accent-blue)'>${meta.user_level}</span>`;
      }

      // ‚úÖ [Backend Flag Check] RAG ÏÇ¨Ïö© Ïó¨Î∂Ä Î∞∞ÏßÄ ÌëúÏãú
      if (reply?.ui_hints?.used_pdf_rag) {
        debugInfo += ` ‚Ä¢ <span style='color:var(--success); font-weight:bold;'>üìÑ PDF RAG</span>`;
      }

      addMsg("bot", text, debugInfo);
      setStatus("idle", "Ready");
      
      setJson($("replyJson"), reply);
      setJson($("stateJson"), state);
      saveState({ lastResponse: json });

    } catch (err) {
      removeThinking();
      addMsg("bot", "Network Error: " + String(err), nowTime());
      setStatus("error", "Network Error");
    }
  }

  function clearAll() {
    $("msgs").innerHTML = '<div class="msg bot" style="opacity:0.6;">ÎåÄÌôîÍ∞Ä Ï¥àÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§.<br><span class="meta-info">System Reset</span></div>';
    $("reqJson").textContent = "{}";
    $("replyJson").textContent = "{}";
    $("stateJson").textContent = "{}";
    $("traceId").textContent = "-";
    setStatus("idle", "Ready");
  }

  function loadExamples() {
    const examples = [
      { mode:"edu", domain:"education", msg:"ÏñëÏûêÏó≠ÌïôÏù¥ Î≠êÏïº?" },
      { mode:"edu", domain:"education", msg:"ÌîÑÎûëÏä§ ÌòÅÎ™ÖÏùò ÏõêÏù∏ ÏïåÎ†§Ï§ò" },
      { mode:"edu", domain:"education", msg:"Python Î¶¨Ïä§Ìä∏ ÏÇ¨Ïö©Î≤ï" },
      { mode:"edu", domain:"education", msg:"ÏÇ¨Ïù¥Ìä∏ Î©îÎâ¥ Ïñ¥ÎîîÏûàÏñ¥?" },
    ];
    const pick = examples[Math.floor(Math.random() * examples.length)];
    $("mode").value = pick.mode;
    $("domain").value = pick.domain;
    $("userMessage").value = pick.msg;
    
    presetEdu();
  }

  function presetEdu() {
    $("mode").value = "edu";
    $("domain").value = "education";
    $("deviceType").value = "web";
  }

  // --- PDF Drop Zone Logic ---
  const dropZone = $("pdfDropZone");
  const fileInput = $("pdfInput");
  const dropText = $("dropText");

  dropZone.addEventListener("click", () => fileInput.click());

  fileInput.addEventListener("change", (e) => {
    if (e.target.files.length) uploadFile(e.target.files[0]);
  });

  dropZone.addEventListener("dragover", (e) => {
    e.preventDefault();
    dropZone.classList.add("dragover");
  });

  dropZone.addEventListener("dragleave", () => {
    dropZone.classList.remove("dragover");
  });

  dropZone.addEventListener("drop", (e) => {
    e.preventDefault();
    dropZone.classList.remove("dragover");
    if (e.dataTransfer.files.length) {
      uploadFile(e.dataTransfer.files[0]);
    }
  });

  async function uploadFile(file) {
    if (file.type !== "application/pdf") {
      alert("PDF ÌååÏùºÎßå Í∞ÄÎä•Ìï©ÎãàÎã§.");
      return;
    }

    dropText.innerHTML = `Uploading <b>${file.name}</b>...`;
    
    const formData = new FormData();
    formData.append("file", file);

    try {
      const res = await fetch("/api/upload_pdf", {
        method: "POST",
        body: formData
      });
      const json = await res.json();
      
      if (res.ok) {
        dropText.innerHTML = `‚úÖ <b>${json.filename}</b> Loaded!<br>(${json.chunks} chunks)`;
        dropZone.style.borderColor = "var(--success)";
      } else {
        dropText.textContent = "Upload Failed";
      }
    } catch (e) {
      console.error(e);
      dropText.textContent = "Error: " + e.message;
    }
  }

  // --- Persistence ---
  function saveState(patch) {
    const cur = loadState();
    const next = { ...(cur || {}), ...(patch || {}) };
    localStorage.setItem(storeKey, JSON.stringify(next));
  }
  function loadState() {
    try { return JSON.parse(localStorage.getItem(storeKey)); } catch(e){ return null; }
  }
  function restore() {
    const st = loadState();
    if (!st) return;
    if (st.lastBody?.meta) {
      const m = st.lastBody.meta;
      $("clientSessionId").value = m.client_session_id || "sess_web_1";
      $("mode").value = m.mode || "edu";
      if (m.user_level) $("userLevel").value = m.user_level;
    }
  }

  // --- Events ---
  $("btnSend").addEventListener("click", send);
  $("btnClear").addEventListener("click", () => { clearAll(); saveState({}); });
  $("btnExamples").addEventListener("click", loadExamples);
  $("btnPresetEdu").addEventListener("click", presetEdu);
  
  const ta = $("userMessage");
  ta.addEventListener("input", function() {
    this.style.height = 'auto';
    this.style.height = (this.scrollHeight) + 'px';
  });
  ta.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      send();
    }
  });

  restore();
</script>
</body>
</html>